# =========================
# 数据库配置
# =========================
# PostgreSQL 连接字符串。
# 格式：postgresql://用户名:密码@主机:端口/数据库名
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/us_cycle_topics

# =========================
# Genkit / 模型配置
# =========================
# 默认模型名称（必须包含 provider 前缀）。
# 例如：googleai/gemini-2.5-flash 或 compat/gpt-4o-mini
GENKIT_MODEL=googleai/gemini-2.5-flash

# OpenAI-compatible 基础地址（可选）。
# 留空表示不启用 compat 提供商；设置后可配合 GENKIT_MODEL=compat/xxx 使用。
GENKIT_BASEURL=

# Prompt 版本号，用于内容追溯与灰度管理。
# 建议每次提示词重大调整时递增（如 v1 -> v2）。
GENKIT_PROMPT_VERSION=v1

# 生成自动输入（topic/city/keyword）的 dotPrompt 名称。
PRODUCER_AUTO_INPUT_PROMPT_NAME=seo-auto-input

# 生成文章大纲（outline）的 dotPrompt 名称。
PRODUCER_OUTLINE_PROMPT_NAME=seo-outline

# 生成最终文章（article）的 dotPrompt 名称。
PRODUCER_PROMPT_NAME=seo-article

# 质量主阈值（0-100）。
# 无 hard failure 且分数 >= 该值时，可直接进入 generated。
QUALITY_MIN_SCORE=70

# 软审核阈值（0-100）。
# 无 hard failure 且分数位于 [该值, QUALITY_MIN_SCORE) 时进入 needs_review。
QUALITY_SOFT_REVIEW_THRESHOLD=60

# 自动修订最大次数（仅针对 soft failure 场景）。
# 每次修订后会重新评估质量分。
PRODUCER_MAX_REVISIONS=2

# needs_review 队列告警阈值。
# 当待人工审核数量 >= 该值时触发告警。
NEEDS_REVIEW_ALERT_THRESHOLD=20

# =========================
# Hugo 配置
# =========================
# 文章 Markdown 输出目录（通常是 Hugo 的 content/posts 目录）。
HUGO_CONTENT_DIR=./hugo-site/content/posts

# Hugo 可执行命令名（系统 PATH 中可找到时直接填 hugo）。
HUGO_COMMAND=hugo

# Hugo build 附加参数。
# 推荐保留 --minify 以压缩输出。
HUGO_BUILD_ARGS=--minify

# Hugo 站点根目录（执行 hugo build 的工作目录）。
HUGO_WORKDIR=./hugo-site

# Hugo 构建后的 public 目录（用于发布同步）。
HUGO_PUBLIC_DIR=./hugo-site/public

# =========================
# 调度与稳定性配置
# =========================
# 定时任务 cron 表达式。
# 示例：0 * * * * 表示每小时整点执行一次。
SCHEDULER_CRON=0 * * * *

# 每次 pipeline 执行前是否进行 preflight 检查（数据库、hugo、rsync 等）。
PREFLIGHT_ON_RUN=true

# preflight 时是否自动创建 Hugo 必需目录/基础文件。
PREFLIGHT_ENSURE_HUGO_SCAFFOLD=true

# 单次渲染批大小（每轮最多处理多少条记录）。
RENDER_BATCH_SIZE=50

# 失败重试最大次数（如渲染失败、临时连接波动等）。
RETRY_MAX_ATTEMPTS=3

# 重试初始退避时间（毫秒）。
# 实际会按指数退避逐步增加。
RETRY_BACKOFF_MS=2000

# 渲染锁最长持有秒数（用于防并发重入保护场景）。
MAX_RENDER_LOCK_SECONDS=1200

# PG 启动探测最大尝试次数（bootstrap/preflight 阶段）。
PG_BOOTSTRAP_MAX_ATTEMPTS=20

# PG 启动探测退避时间（毫秒）。
PG_BOOTSTRAP_BACKOFF_MS=2000

# =========================
# 发布配置（VPS rsync）
# =========================
# 发布方式：
# - rsync：执行 rsync 同步
# - none：跳过实际发布
PUBLISH_METHOD=rsync

# rsync 目标地址。
# 格式示例：user@example.com:/var/www/us-cycle-topics/
RSYNC_TARGET=user@example.com:/var/www/us-cycle-topics/

# rsync 参数。
# -a 保留属性；-z 压缩；--delete 删除目标中本地不存在的文件。
RSYNC_FLAGS=-az --delete

# 是否 dry-run（只演练不真正上传）。
# true 建议用于联调；上线前改为 false。
RSYNC_DRY_RUN=true

# smoke 示例数据数量。
# `npm run seed:sample` 未显式传 --count 时使用该值。
SMOKE_SEED_COUNT=3

# =========================
# 告警配置
# =========================
# 告警 Webhook 地址（可选）。
# 留空则只写日志，不发送外部通知。
ALERT_WEBHOOK_URL=

# 每日汇总告警小时（本地时区小时，0-23）。
ALERT_DAILY_HOUR_LOCAL=9

# 告警与调度时区。
ALERT_TIMEZONE=Asia/Shanghai

# ============================================================
# 模板 1：最小可运行配置（本地联调）
# 用途：快速跑通 producer -> renderer -> pipeline，默认不真实发布。
# 使用方式：将下面区块复制到 .env（按需改 DATABASE_URL）。
# ============================================================
# DATABASE_URL=postgresql://postgres:postgres@localhost:5432/us_cycle_topics
# GENKIT_MODEL=googleai/gemini-2.5-flash
# GEMINI_API_KEY=你的_gemini_key
# GENKIT_BASEURL=
# GENKIT_PROMPT_VERSION=v1
# PRODUCER_AUTO_INPUT_PROMPT_NAME=seo-auto-input
# PRODUCER_OUTLINE_PROMPT_NAME=seo-outline
# PRODUCER_PROMPT_NAME=seo-article
# QUALITY_MIN_SCORE=70
# QUALITY_SOFT_REVIEW_THRESHOLD=60
# PRODUCER_MAX_REVISIONS=2
# NEEDS_REVIEW_ALERT_THRESHOLD=20
# HUGO_CONTENT_DIR=./hugo-site/content/posts
# HUGO_COMMAND=hugo
# HUGO_BUILD_ARGS=--minify
# HUGO_WORKDIR=./hugo-site
# HUGO_PUBLIC_DIR=./hugo-site/public
# SCHEDULER_CRON=0 * * * *
# PREFLIGHT_ON_RUN=true
# PREFLIGHT_ENSURE_HUGO_SCAFFOLD=true
# RENDER_BATCH_SIZE=50
# RETRY_MAX_ATTEMPTS=3
# RETRY_BACKOFF_MS=2000
# MAX_RENDER_LOCK_SECONDS=1200
# PG_BOOTSTRAP_MAX_ATTEMPTS=20
# PG_BOOTSTRAP_BACKOFF_MS=2000
# PUBLISH_METHOD=none
# RSYNC_TARGET=
# RSYNC_FLAGS=-az --delete
# RSYNC_DRY_RUN=true
# SMOKE_SEED_COUNT=3
# ALERT_WEBHOOK_URL=
# ALERT_DAILY_HOUR_LOCAL=9
# ALERT_TIMEZONE=Asia/Shanghai

# ============================================================
# 模板 2：生产推荐配置（VPS/远程发布）
# 用途：真实发布到服务器，建议先在灰度环境验证。
# 注意：上线前将 RSYNC_DRY_RUN=false。
# ============================================================
# DATABASE_URL=postgresql://app_user:strong_password@db-host:5432/us_cycle_topics
# GENKIT_MODEL=googleai/gemini-2.5-flash
# GEMINI_API_KEY=你的_gemini_key
# GENKIT_BASEURL=
# GENKIT_PROMPT_VERSION=v2
# PRODUCER_AUTO_INPUT_PROMPT_NAME=seo-auto-input
# PRODUCER_OUTLINE_PROMPT_NAME=seo-outline
# PRODUCER_PROMPT_NAME=seo-article
# QUALITY_MIN_SCORE=75
# QUALITY_SOFT_REVIEW_THRESHOLD=65
# PRODUCER_MAX_REVISIONS=2
# NEEDS_REVIEW_ALERT_THRESHOLD=30
# HUGO_CONTENT_DIR=./hugo-site/content/posts
# HUGO_COMMAND=hugo
# HUGO_BUILD_ARGS=--minify
# HUGO_WORKDIR=./hugo-site
# HUGO_PUBLIC_DIR=./hugo-site/public
# SCHEDULER_CRON=*/30 * * * *
# PREFLIGHT_ON_RUN=true
# PREFLIGHT_ENSURE_HUGO_SCAFFOLD=true
# RENDER_BATCH_SIZE=100
# RETRY_MAX_ATTEMPTS=5
# RETRY_BACKOFF_MS=3000
# MAX_RENDER_LOCK_SECONDS=1800
# PG_BOOTSTRAP_MAX_ATTEMPTS=30
# PG_BOOTSTRAP_BACKOFF_MS=2000
# PUBLISH_METHOD=rsync
# RSYNC_TARGET=deploy_user@your-server:/var/www/us-cycle-topics/
# RSYNC_FLAGS=-az --delete
# RSYNC_DRY_RUN=false
# SMOKE_SEED_COUNT=5
# ALERT_WEBHOOK_URL=https://your-alert-webhook
# ALERT_DAILY_HOUR_LOCAL=9
# ALERT_TIMEZONE=Asia/Shanghai

# ============================================================
# OpenAI-compatible 参考（可替代 Gemini）
# 说明：启用 compat 时，GENKIT_MODEL 必须使用 compat/ 前缀。
# ============================================================
# GENKIT_BASEURL=https://your-openai-compatible-endpoint/v1
# GENKIT_MODEL=compat/gpt-4o-mini
# OPENAI_API_KEY=你的_openai_compatible_key
